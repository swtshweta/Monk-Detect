<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Detect and Format Credit Card Type</title>
  <link rel="stylesheet" href="css/main.css">
</head>

<body>

	<form name="ccfrm" method="get">
    <div class="card">
      <label for="card_number">Enter your Credit Card Number:</label>
      <p>
        <input name="card_number" type="text" value="" id="ccard_number" />
        <span class="card_icon"></span>
      </p>
      <p class="status">
        <span class="status_icon"></span>
        <span class="status_message"></span>
      </p>
	  <label for="cvv">Enter CVV/CID Number: </label>
	  <p>
		<input id="cvv" type="text" maxlength="3" name="cvv" />
		<span class="cvv_icon"></span>
	  </p>
    </div>
  </form>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
  <script type="text/javascript" src="js/jquery.maskedinput-1.3.min.js"></script>
  <script type="text/javascript" src="js/cardchecker.js"></script>
  <script type="text/javascript">
	  jQuery(function($) {

		var creditCardId = '#ccard_number',
			cvvIconClass = '.cvv_icon',
			cardStatusClass = '.status',
			cardIconClass = '.card_icon';

        // hiding the status as the user focuses on the credit card input field
        $(creditCardId).bind('focus', function() {

			//unmasking the text field as user starts typing
			$(creditCardId).unmask();

			//removing cvv image
			$(cvvIconClass).html('');

			//hiding status
            $(cardStatusClass).hide();
        });

        // showing the status when the user tabs or clicks away from the credit card input field
        $(creditCardId).bind('blur', function() {
            $(cardStatusClass).show();

        });

        // checking input value entered using jquery.cardchecker
        $(creditCardId).cardchecker({
            callback: function(result) {

                var status = (result.validLen && result.validLuhn) ? 'valid' : 'invalid',
                    message = '',
                    types = '',
					i;

                // Getting the names of all accepted card types.
                for (i in result.option.types) {
                    types += result.option.types[i].cardName + ", ";
                }
                types = types.substring(0, types.length-2);

                // Set the status message
                if (result.len < 1) {
                    message = 'Please enter a credit card number.';
                } else if (!result.cardClass) {
                    message = 'We accept the following card types: ' + types + '.';
                } else if (!result.validLen) { //if entered wrong number of digits
                    message = 'It appears to be wrong number of digit. Please check that this number matches your "' + result.cardName + '" card';
                } else if (!result.validLuhn) { //if mistype any digit
                    message = 'Did you mistype a digit as this number matches your "' + result.cardName + '" card ';
                } else {
                    message = 'It looks like a valid ' + result.cardName + '.';
					if ( result.validLen ) {

						//applying masking
						if ( result.cardName === 'Visa' ) { //if the card is Visa
							$(creditCardId).mask("9999-9999-9999-9?999");
						}
						if ( result.cardName === 'American Express' ) { //if the card is American Express
							$(creditCardId).mask("9999-999999-99999");
						}
						if ( result.cardName === 'MasterCard' ) { //if the card is MasterCard
							$(creditCardId).mask("9999-9999-9999-9999");
						}
						if ( result.cardName === 'Discover' ) { //if the card is Discover
							$(creditCardId).mask("9999-9999-9999-9999");
						}
						if ( result.cardName === 'JCB' ) { //if the card is JCB
							$(creditCardId).mask("9999-9999-9999-9999");
						}
						if ( result.cardName === 'Diners Club' ) { //if the card is Diners Club
							$(creditCardId).mask("9999-999999-9999");
						}
						if ( result.cardName === 'Maestro' ) { //if the card is Maestro
							$(creditCardId).mask("9999-9999-9999?-9999999");
						}

						// Show cvv icon
						 $(cvvIconClass).html('<img src="images/' + result.cvvName + '" />');
					}
                }

                // Show credit card icon
                $(cardIconClass).removeClass().addClass('card_icon ' + result.cardClass);

                // Show status message
                $(cardStatusClass).removeClass('invalid valid').addClass(status).children('.status_message').text(message);

            }
        });
    });
  </script>
</body>

</html>